generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Locale {
  ru
  en
}

enum SubscriptionStatus {
  none
  active
  inactive
}

enum HoroscopePeriod {
  day
  week
  month
}

model User {
  id                    Int                @id @default(autoincrement())
  email                 String             @unique
  locale                Locale             @default(ru)
  subscription          SubscriptionStatus @default(none)
  subscriptionEndsAt    DateTime?
  stripeCustomerId      String?
  stripePaymentMethodId String?
  quizResult            Json?
  createdAt             DateTime           @default(now())
  loginLinks            LoginLink[]
  horoscopes            Horoscope[]
  sketches              Sketch[]
}

model Horoscope {
  id        Int             @id @default(autoincrement())
  userId    Int
  period    HoroscopePeriod
  content   Json
  status    String          @default("pending")
  createdAt DateTime        @default(now())
  user      User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, period])
}

enum SketchType {
  soulmate
  baby
}

model Sketch {
  id        Int             @id @default(autoincrement())
  userId    Int
  type      SketchType
  content   Json
  status    String          @default("pending")
  createdAt DateTime        @default(now())
  user      User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, type])
}

model LoginLink {
  id        Int       @id @default(autoincrement())
  token     String    @unique
  expiresAt DateTime
  usedAt    DateTime?
  createdAt DateTime  @default(now())
  user      User      @relation(fields: [userId], references: [id])
  userId    Int
}
